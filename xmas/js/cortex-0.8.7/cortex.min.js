!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.cortex=e()}}(function(){return function e(t,n,i){function r(s,u){if(!n[s]){if(!t[s]){var o="function"==typeof require&&require;if(!u&&o)return o(s,!0);if(a)return a(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var h=n[s]={exports:{}};t[s][0].call(h.exports,function(e){var n=t[s][1][e];return r(n?n:e)},h,h.exports,e,t,n,i)}return n[s].exports}for(var a="function"==typeof require&&require,s=0;s<i.length;s++)r(i[s]);return r}({1:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=function(e,t,n){for(var i=!0;i;){var r=e,a=t,s=n;u=l=o=void 0,i=!1;var u=Object.getOwnPropertyDescriptor(r,a);if(void 0!==u){if("value"in u)return u.value;var o=u.get;return void 0===o?void 0:o.call(s)}var l=Object.getPrototypeOf(r);if(null===l)return void 0;e=l,t=a,n=s,i=!0}};t.exports=function(){var t=e("./pubsub"),n=e("./data_wrapper")(t),u={N:"new",E:"update",A:"update",D:"delete"},o=function(e){function n(e,t){i(this,n),s(Object.getPrototypeOf(n.prototype),"constructor",this).call(this,e),this.__value=e,this.__path=[],this.__updates=[],this.__callbacks=t?[t]:[],this.__loopProcessing=!1,this.__subscribe(),this.__changes=[],this.__wrap()}return r(n,e),a(n,[{key:"on",value:function(e,t){"update"===e&&this.__callbacks.push(t)}},{key:"off",value:function(e,t){if("update"===e)if(t){for(var n=0,i=this.__callbacks.length;i>n;n++)if(t===this.__callbacks[n]){this.__callbacks.splice(n,1);break}}else this.__callbacks=[]}},{key:"update",value:function(e){return this.__checkUpdate(e.oldValue,e.value,e.path)?(this.__loopProcessing||(this.__loopProcessing=!0,setTimeout(this.__batchAll.bind(this),0)),!0):!1}},{key:"__batchAll",value:function(){this.__batchSetValue(),this.__wrap(),this.__loopProcessing=!1,this.__runCallbacks()}},{key:"__batchSetValue",value:function(){for(var e=0,t=this.__updates.length;t>e;e++)this.__setValue(this.__updates[e].newValue,this.__updates[e].path);this.__updates=[]}},{key:"__runCallbacks",value:function(){for(var e=0,t=this.__callbacks.length;t>e;e++)this.__callbacks[e]&&this.__callbacks[e](this)}},{key:"__subscribe",value:function(){this.__eventId=t.subscribeToCortex(function(e,t){this.update(t)}.bind(this),function(e,t){this.__remove(t.path)}.bind(this))}},{key:"__remove",value:function(e){if(e.length){var t=e.slice(0,e.length-1),n=this.__subValue(t),i=e[e.length-1],r=n[i],a=this.constructor.deepClone(n);return n.constructor===Object?delete n[i]:n.constructor===Array&&n.splice(i,1),this.update({value:n,path:t,oldValue:a}),r}delete this.__wrappers,delete this.__value}},{key:"__setValue",value:function(e,t){if(t.length>1){var n=this.__subValue(t.slice(0,t.length-1));n[t[t.length-1]]=e}else 1===t.length?this.__value[t[0]]=e:this.__value=e}},{key:"__checkUpdate",value:function(e,t,n){var i;if(e)return i=this.constructor.deepDiff(e,t),this.__computeChanges(i,n),!0;var e=this.__subValue(n);return i=this.constructor.deepDiff(e,t),i?(this.__updates.push({newValue:t,path:n}),this.__computeChanges(i,n),!0):!1}},{key:"__computeChanges",value:function(e,t){var n,i,r;this.__loopProcessing||(this.__changes=[]);for(var a=0,s=e.length;s>a;a++)r=e[a],n=u[r.item?r.item.kind:r.kind],i=t.slice(),r.path&&(i=i.concat(r.path)),r.index&&i.push(r.index),this.__changes.push({type:n,path:i,oldValue:r.item?r.item.lhs:r.lhs,newValue:r.item?r.item.rhs:r.rhs})}}]),n}(n);return"undefined"!=typeof window&&null!==window&&(window.Cortex=o),o}()},{"./data_wrapper":3,"./pubsub":4}],2:[function(e,t,n){(function(e){!function(i){"use strict";function r(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}function a(e,t){Object.defineProperty(this,"kind",{value:e,enumerable:!0}),t&&t.length&&Object.defineProperty(this,"path",{value:t,enumerable:!0})}function s(e,t,n){s.super_.call(this,"E",e),Object.defineProperty(this,"lhs",{value:t,enumerable:!0}),Object.defineProperty(this,"rhs",{value:n,enumerable:!0})}function u(e,t){u.super_.call(this,"N",e),Object.defineProperty(this,"rhs",{value:t,enumerable:!0})}function o(e,t){o.super_.call(this,"D",e),Object.defineProperty(this,"lhs",{value:t,enumerable:!0})}function l(e,t,n){l.super_.call(this,"A",e),Object.defineProperty(this,"index",{value:t,enumerable:!0}),Object.defineProperty(this,"item",{value:n,enumerable:!0})}function h(e,t,n){var i=e.slice((n||t)+1||e.length);return e.length=0>t?e.length+t:t,e.push.apply(e,i),e}function c(e,t,n,r,a,f,p){a=a||[];var _=a.slice(0);if("undefined"!=typeof f){if(r&&r(_,f))return;_.push(f)}var v=typeof e,d=typeof t;if("undefined"===v)"undefined"!==d&&n(new u(_,t));else if("undefined"===d)n(new o(_,e));else if(v!==d)n(new s(_,e,t));else if(e instanceof Date&&t instanceof Date&&e-t!==0)n(new s(_,e,t));else if("object"===v&&null!==e&&null!==t){if(p=p||[],p.indexOf(e)<0){if(p.push(e),Array.isArray(e)){{var b;e.length}for(b=0;b<e.length;b++)b>=t.length?n(new l(_,b,new o(i,e[b]))):c(e[b],t[b],n,r,_,b,p);for(;b<t.length;)n(new l(_,b,new u(i,t[b++])))}else{var y=Object.keys(e),w=Object.keys(t);y.forEach(function(a,s){var u=w.indexOf(a);u>=0?(c(e[a],t[a],n,r,_,a,p),w=h(w,u)):c(e[a],i,n,r,_,a,p)}),w.forEach(function(e){c(i,t[e],n,r,_,e,p)})}p.length=p.length-1}}else e!==t&&("number"===v&&isNaN(e)&&isNaN(t)||n(new s(_,e,t)))}function f(e,t,n,r){return r=r||[],c(e,t,function(e){e&&r.push(e)},n),r.length?r:i}function p(e,t,n){if(n.path&&n.path.length){var i,r=e[t],a=n.path.length-1;for(i=0;a>i;i++)r=r[n.path[i]];switch(n.kind){case"A":p(r[n.path[i]],n.index,n.item);break;case"D":delete r[n.path[i]];break;case"E":case"N":r[n.path[i]]=n.rhs}}else switch(n.kind){case"A":p(e[t],n.index,n.item);break;case"D":e=h(e,t);break;case"E":case"N":e[t]=n.rhs}return e}function _(e,t,n){if(e&&t&&n&&n.kind){for(var i=e,r=-1,a=n.path.length-1;++r<a;)"undefined"==typeof i[n.path[r]]&&(i[n.path[r]]="number"==typeof n.path[r]?new Array:{}),i=i[n.path[r]];switch(n.kind){case"A":p(i[n.path[r]],n.index,n.item);break;case"D":delete i[n.path[r]];break;case"E":case"N":i[n.path[r]]=n.rhs}}}function v(e,t,n){if(n.path&&n.path.length){var i,r=e[t],a=n.path.length-1;for(i=0;a>i;i++)r=r[n.path[i]];switch(n.kind){case"A":v(r[n.path[i]],n.index,n.item);break;case"D":r[n.path[i]]=n.lhs;break;case"E":r[n.path[i]]=n.lhs;break;case"N":delete r[n.path[i]]}}else switch(n.kind){case"A":v(e[t],n.index,n.item);break;case"D":e[t]=n.lhs;break;case"E":e[t]=n.lhs;break;case"N":e=h(e,t)}return e}function d(e,t,n){if(e&&t&&n&&n.kind){var i,r,a=e;for(r=n.path.length-1,i=0;r>i;i++)"undefined"==typeof a[n.path[i]]&&(a[n.path[i]]={}),a=a[n.path[i]];switch(n.kind){case"A":v(a[n.path[i]],n.index,n.item);break;case"D":a[n.path[i]]=n.lhs;break;case"E":a[n.path[i]]=n.lhs;break;case"N":delete a[n.path[i]]}}}function b(e,t,n){if(e&&t){var i=function(i){(!n||n(e,t,i))&&_(e,t,i)};c(e,t,i)}}var y,w,g=[];y="object"==typeof e&&e?e:"undefined"!=typeof window?window:{},w=y.DeepDiff,w&&g.push(function(){"undefined"!=typeof w&&y.DeepDiff===f&&(y.DeepDiff=w,w=i)}),r(s,a),r(u,a),r(o,a),r(l,a),Object.defineProperties(f,{diff:{value:f,enumerable:!0},observableDiff:{value:c,enumerable:!0},applyDiff:{value:b,enumerable:!0},applyChange:{value:_,enumerable:!0},revertChange:{value:d,enumerable:!0},isConflict:{value:function(){return"undefined"!=typeof w},enumerable:!0},noConflict:{value:function(){return g&&(g.forEach(function(e){e()}),g=null),f},enumerable:!0}}),"undefined"!=typeof t&&t&&"object"==typeof n&&n&&t.exports===n?t.exports=f:y.DeepDiff=f}()}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],3:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();t.exports=function(t){var n=e("deep-diff").diff,a=function(){function e(t){i(this,e),this.__eventId=t.eventId,this.__value=t.value,this.__path=t.path||[],this.__changes=t.changes||[],this.__wrap(),this.val=this.getValue}return r(e,[{key:"set",value:function(e,n){var i=n||{};i.value=e,i.path=this.__path,t.publish("update"+this.__eventId,i)}},{key:"getValue",value:function(){return this.__value}},{key:"getPath",value:function(){return this.__path}},{key:"getKey",value:function(){return this.__path[this.__path.length-1]}},{key:"getChanges",value:function(){return this.__changes}},{key:"didChange",value:function(e){if(!e)return this.__changes.length>0;for(var t=0,n=this.__changes.length;n>t;t++){var i=this.__changes[t];if(i.path[0]===e||this.__hasChange(i,e))return!0}return!1}},{key:"forEach",value:function(e){if(this.__isObject())for(var t in this.__wrappers)e(t,this.__wrappers[t],this.__wrappers);else this.__isArray()&&this.__wrappers.forEach(e)}},{key:"remove",value:function(){t.publish("remove"+this.__eventId,{path:this.__path})}},{key:"__subValue",value:function(e){for(var t=this.__value,n=0,i=e.length;i>n;n++)t=t[e[n]];return t}},{key:"__wrap",value:function(){if(this.__cleanup(),this.__isObject()){this.__wrappers={};for(var e in this.__value)this.__wrapChild(e)}else if(this.__isArray()){this.__wrappers=[];for(var t=0,n=this.__value.length;n>t;t++)this.__wrapChild(t)}}},{key:"__wrapChild",value:function(t){var n=this.__path.slice();n.push(t),this.__wrappers[t]=new e({value:this.__value[t],path:n,eventId:this.__eventId,changes:this.__childChanges(t)}),this[t]=this.__wrappers[t]}},{key:"__childChanges",value:function(e){for(var t,n=[],i=0,r=this.__changes.length;r>i;i++)t=this.__changes[i],t.path[0]===e?n.push({type:t.type,path:t.path.slice(1,t.path.length),oldValue:t.oldValue,newValue:t.newValue}):this.__hasChange(t,e)&&n.push({type:t.type,path:[],oldValue:t.oldValue?t.oldValue[e]:void 0,newValue:t.newValue?t.newValue[e]:void 0});return n}},{key:"__hasChange",value:function(e,t){return 0===e.path.length&&(e.oldValue&&e.oldValue[t]||e.newValue&&e.newValue[t])}},{key:"__cleanup",value:function(){if(this.__wrappers){if(this.__isObject())for(var e in this.__wrappers)delete this[e];else if(this.__isArray())for(var t=0,n=this.__wrappers.length;n>t;t++)delete this[t];delete this.__wrappers}}},{key:"__isObject",value:function(){return this.__value&&this.__value.constructor===Object}},{key:"__isArray",value:function(){return this.__value&&this.__value.constructor===Array}}],[{key:"deepDiff",value:function(e,t){return n(e,t)}},{key:"deepClone",value:function(t){var n;if(null==t||"object"!=typeof t)return t;if(t instanceof Date)return n=new Date,n.setTime(t.getTime()),n;if(t instanceof Array){n=[];for(var i=0,r=t.length;r>i;i++)n[i]=e.deepClone(t[i]);return n}if(t instanceof Object){n={};for(var a in t)t.hasOwnProperty(a)&&(n[a]=e.deepClone(t[a]));return n}throw new Error("Unable to copy obj! Its type isn't supported.")}}]),e}(),s=e("./wrappers/array"),u=e("./wrappers/hash"),o=function(e,t){for(var n=0,i=t.length;i>n;n++)for(var r in t[n])e.prototype[r]=t[n][r]};return o(a,[s,u]),a}},{"./wrappers/array":5,"./wrappers/hash":6,"deep-diff":2}],4:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();t.exports=function(){var e=function(){function e(){i(this,e),this.uid=-1,this.topics={}}return r(e,[{key:"subscribe",value:function(e,t){this.topics.hasOwnProperty(e)||(this.topics[e]=[]),this.topics[e].push({callback:t})}},{key:"publish",value:function(e,t){if(!this.topics.hasOwnProperty(e))return!1;for(var n=this.topics[e],i=0,r=n.length;r>i;i++)n[i].callback(e,t);return!0}},{key:"subscribeToCortex",value:function(e,t){return this.uid+=1,this.subscribe("update"+this.uid,e),this.subscribe("remove"+this.uid,t),this.uid}},{key:"unsubscribeFromCortex",value:function(e){delete this.topics["update"+e],delete this.topics["remove"+e]}}]),e}();return new e}()},{}],5:[function(e,t,n){"use strict";var i={count:function(){return this.__value.length},map:function(e){return this.__wrappers.map(e)},filter:function(e,t){return this.__wrappers.filter(e,t)},find:function(e){for(var t=0,n=this.__wrappers.length;n>t;t++)if(e(this.__wrappers[t],t,this.__wrappers))return this.__wrappers[t];return null},findIndex:function(e){for(var t=0,n=this.__wrappers.length;n>t;t++)if(e(this.__wrappers[t],t,this.__wrappers))return t;return-1},push:function(e){var t=this.constructor.deepClone(this.__value),n=this.__value.push(e);return this.set(this.__value,{oldValue:t}),n},pop:function(){var e=this.constructor.deepClone(this.__value),t=this.__value.pop();return this.set(this.__value,{oldValue:e}),t},unshift:function(e){var t=this.constructor.deepClone(this.__value),n=this.__value.unshift(e);return this.set(this.__value,{oldValue:t}),n},shift:function(){var e=this.constructor.deepClone(this.__value),t=this.__value.shift();return this.set(this.__value,{oldValue:e}),t},insertAt:function(e){var t=this.constructor.deepClone(this.__value),n=Array.prototype.slice.call(arguments,1);Array.prototype.splice.apply(this.__value,[e,0].concat(n)),this.set(this.__value,{oldValue:t})},removeAt:function(e){var t=void 0===arguments[1]?1:arguments[1],n=this.constructor.deepClone(this.__value),i=this.__value.splice(e,t);return this.set(this.__value,{oldValue:n}),i}};t.exports=i},{}],6:[function(e,t,n){"use strict";var i={keys:function(){return Object.keys(this.__value)},values:function r(){var e,r=[];for(e in this.__value)r.push(this.__value[e]);return r},hasKey:function(e){return null!=this.__value[e]},destroy:function(e){var t=this.constructor.deepClone(this.__value),n=this.__value[e];return delete this.__value[e],this.set(this.__value,{oldValue:t}),n},add:function(e,t){var n=this.constructor.deepClone(this.__value);return this.__value[e]=t,this.set(this.__value,{oldValue:n}),t}};t.exports=i},{}]},{},[1])(1)});